<!DOCTYPE html>
    <html>
        <head>
            <meta charset="utf-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <title>Oikos - <%= address %></title>
            <meta name="description" content="">
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <link rel="stylesheet" href="css/style.css">
            <link  rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Cairo">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        </head>
        <body style="margin: 0;">
            <!-- The sidebar -->
            <div class="sidebar">
                <div class="menu_bar">Menu</div>
                <a class="active" href="/">Home</a>
                <a href="/">Search</a>
            </div>

            <div style="display: flex; padding: 10pt; background-color: var(--sequoia-green); align-items: center; justify-content: center; margin-left: 200px;">
                <div class="oikos_title">
                    OIKOS GARDEN
                </div>
                <div class="opp_detail_title">
                    Opportunity Details
                </div>
                <div style="text-align: center; color: white; margin-left: 20%; font-size: 16pt;">
                    Austin v
                </div>
                <div style="display: flex; margin-left: 5%; align-items: center; justify-content: center;">
                    <div style="display: flex; border-radius: 50%; width: 50px; height: 50px; background-color: var(--light-gray); overflow: hidden; align-items: center; justify-items: center; justify-content: center;">
                        <img style="height: 50pt; width: 50pt;  align-items: center; justify-items: center;" src="uploads/<%= user_account.profile_pic %>">
                    </div>
                    <div class="sign_out_btn">
                        SIGN OUT
                    </div>
                </div>
                
            </div>
            
            <div style="display: flex; align-items: center; justify-content: center; padding: 5px 0; border-bottom: solid; border-color: var(--dark-green); margin-left: 200px;">
                <div style="display: flex; align-items: center; justify-content: center;">
                    <embed src="uploads/<%= prop_image %>" width="90pt" height="50pt" style="margin: auto;"/>
                </div>
                <div style="text-align: center; padding-left: 10pt">
                    <span style="font-size: 18pt;"><b><%= address %></b></span><br>
                    <%= city %>, <%= state %> <%= zip %>
                </div>
                <div style="text-align: center; padding-left: 70pt">
                    <span style="font-size: 18pt;color: var(--green-hills)"><b><%= list_price %></b></span><br>
                    List
                </div>
                <div style="text-align: center; padding-left: 20pt">
                    <span style="font-size: 18pt;"><b><%= cap_rate*100 %>%</b></span><br>
                    Cap Rate
                </div>
                <div style="text-align: center; padding-left: 20pt">
                    <span style="font-size: 18pt;"><b><%= r_value %></b></span><br>
                    R Value
                </div>
                <div style="text-align: center; padding-left: 20pt">
                    <span style="font-size: 18pt;"><b><%= m_value %></b></span><br>
                    M Value
                </div>
                <div class="save_btn">
                    SAVE
                </div>
                <div class="visit_btn">
                    VISIT
                </div>
                <div class="reject_btn">
                    REJECT
                </div>
                <div class="offer_btn_val">
                    OFFER
                </div>
            </div>

            <div class="subpage_navbar">
                <a class="inactive_subpage" href="/">Summary</a>
                <a class="inactive_subpage" href="/valuation">Valuation</a>
                <a class="active_subpage" href="/comps">Comps</a>
                <a class="inactive_subpage" href="/financials">Financials</a>                
            </div>
            <div style="display: flex; margin-left: 200px;">
                <div class="comps_cpa">
                    <div style="font-weight: bold; color: white; background-color: red; text-align: center; padding: 5px 0px; width: 300px; margin: 0 auto;">
                        Closed
                    </div>
                    <table class="cpa_table">
                        <tr>
                            <td>
                                # / DOM
                            </td>
                            <td>
                                Low
                            </td>
                            <td>
                                Medium
                            </td>
                            <td>
                                High
                            </td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold;">
                                91</br>
                                <span style="font-size: 10px; font-weight: normal;">34 DAYS</span>
                            </td>
                            <td style="font-weight: bold;">
                                126,000</br>
                                <span style="font-size: 10px; font-weight: normal;">117.30</span>
                            </td>
                            <td style="font-weight: bold;">
                                413,000</br>
                                <span style="font-size: 10px; font-weight: normal;">171.25</span>
                            </td>
                            <td style="font-weight: bold;">
                                1,285,000</br>
                                <span style="font-size: 10px; font-weight: normal;">277.02</span>
                            </td>
                        </tr>
                    </table>
                </div>

                <div class="comps_cpa">
                    <div style="font-weight: bold; color: white; background-color: var(--warm-yellow); text-align: center; padding: 5px 0px; width: 300px; margin: 0 auto;">
                        Pending
                    </div>
                    <table class="cpa_table">
                        <tr>
                            <td>
                                # / DOM
                            </td>
                            <td>
                                Low
                            </td>
                            <td>
                                Medium
                            </td>
                            <td>
                                High
                            </td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold;">
                                91</br>
                                <span style="font-size: 10px; font-weight: normal;">34 DAYS</span>
                            </td>
                            <td style="font-weight: bold;">
                                126,000</br>
                                <span style="font-size: 10px; font-weight: normal;">117.30</span>
                            </td>
                            <td style="font-weight: bold;">
                                413,000</br>
                                <span style="font-size: 10px; font-weight: normal;">171.25</span>
                            </td>
                            <td style="font-weight: bold;">
                                1,285,000</br>
                                <span style="font-size: 10px; font-weight: normal;">277.02</span>
                            </td>
                        </tr>
                    </table>
                </div>

                <div class="comps_cpa">
                    <div style="font-weight: bold; color: white; background-color: var(--green-hills); text-align: center; padding: 5px 0px; width: 300px; margin: 0 auto;">
                        Active
                    </div>
                    <table class="cpa_table">
                        <tr>
                            <td>
                                # / DOM
                            </td>
                            <td>
                                Low
                            </td>
                            <td>
                                Medium
                            </td>
                            <td>
                                High
                            </td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold;">
                                91</br>
                                <span style="font-size: 10px; font-weight: normal;">34 DAYS</span>
                            </td>
                            <td style="font-weight: bold;">
                                126,000</br>
                                <span style="font-size: 10px; font-weight: normal;">117.30</span>
                            </td>
                            <td style="font-weight: bold;">
                                413,000</br>
                                <span style="font-size: 10px; font-weight: normal;">171.25</span>
                            </td>
                            <td style="font-weight: bold;">
                                1,285,000</br>
                                <span style="font-size: 10px; font-weight: normal;">277.02</span>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>

            <div style="display: flex; margin-left: 205px; align-items: center; justify-content: center;">
                <div class="comp_table_container">
                    <table class="comps_table" id="comp_table">
                        <thead>
                            <tr>
                                <th onclick="sortTable(0)">#</th>
                                <th onclick="sortTable(1)">Status</th>
                                <th onclick="sortTable(2)">Date</th>
                                <th onclick="sortTable(3)">MLS #</th>
                                <th onclick="sortTable(4)">Comp Note</th>
                                <th onclick="sortTable(5)">Address</th>
                                <th onclick="sortTable(6)">City</th>
                                <th onclick="sortTable(7)">Type</th>
                                <th onclick="sortTable(8)">Subdivision</th>
                                <th onclick="sortTable(9)">DOM</th>
                                <th onclick="sortTable(10)">DTC</th>
                                <th onclick="sortTable(11)">List Price</th>
                                <th onclick="sortTable(12)">Sale Price</th>
                                <th onclick="sortTable(13)">PSF</th>
                                <th onclick="sortTable(14)">Beds</th>
                                <th onclick="sortTable(15)">Baths</th>
                                <th onclick="sortTable(16)">Levels</th>
                                <th onclick="sortTable(17)">Garage</th>
                                <th onclick="sortTable(18)">Carport</th>
                                <th onclick="sortTable(19)">Slab</th>
                                <th onclick="sortTable(20)">Built</th>
                                <th onclick="sortTable(21)">Sq Ft</th>
                                <th onclick="sortTable(22)">Basement</th>
                                <th onclick="sortTable(23)">Lot</th>
                                <th onclick="sortTable(24)">Pool</th>
                                <th onclick="sortTable(25)">HOA</th>
                                <th onclick="sortTable(26)">SENR</th>
                                <th onclick="sortTable(27)">Finished1</th>
                                <th onclick="sortTable(28)">Finished2</th>
                                <th onclick="sortTable(29)">Finished3</th>
                                <th onclick="sortTable(30)">Total1</th>
                                <th onclick="sortTable(31)">Total2</th>
                                <th onclick="sortTable(32)">Total3</th>
                            </tr>
                        </thead>
                        
                        <% for (property of comps) { %>
                            <tr>
                                <td><%= property.rating*100 %>%</td>
                                <% if (property.status == 0){%>
                                    <td style="background-color: red; color: white;">Closed</td>
                                <%} else if(property.status == 1){%>
                                    <td style="background-color: orange; color: white;">Pending</td>
                                <%} else { %>
                                    <td style="background-color: var(--green-hills); color: white;">Active</td>
                                <% } %>
                                <td><%= property.date %></td>
                                <td><%= property.mls_num %></td>
                                <td> </td>
                                <td><%= property.address %></td>
                                <td><%= property.city %></td>
                                <td><%= property.prop_type %></td>
                                <td><%= property.subdivision %></td>
                                <td><%= property.dom %></td>
                                <td><%= property.dtc %></td>
                                <td>$<%= property.list_price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","); %></td>
                                <td>$<%= property.sale_price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","); %></td>
                                <td><%= property.psf %></td>
                                <td><%= property.beds %></td>
                                <td><%= property.baths %></td>
                                <td><%= property.level %></td>
                                <td><%= property.garage %></td>
                                <% if (property.carport){ %>
                                    <td>Y</td>
                                <%} else{%>
                                    <td>N</td>
                                <%}%>
                                <% if (property.slab){ %>
                                    <td>Y</td>
                                <%} else{%>
                                    <td>N</td>
                                <%}%>
                                <td><%= property.built %></td>
                                <td><%= property.sqft %></td>
                                <% if (property.basement){ %>
                                    <td>Y</td>
                                <%} else{%>
                                    <td>N</td>
                                <%}%>
                                <td><%= property.lot_size %> Acres</td>
                                <% if (property.pool){ %>
                                    <td>Y</td>
                                <%} else{%>
                                    <td>N</td>
                                <%}%>
                                <td><%= property.hoa %></td>
                                <td><%= property.senr %></td>
                                <td><%= property.fin1 %></td>
                                <td><%= property.fin2 %></td>
                                <td><%= property.fin3 %></td>
                                <td><%= property.tot1 %></td>
                                <td><%= property.tot2 %></td>
                                <td><%= property.tot3 %></td>
                            </tr>
                        <% } %>
                    </table>
                </div>
            </div>
            
            
            <script>
                function sortTable(n) {
                    var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
                    table = document.getElementById("comp_table");
                    switching = true;
                    dir = "asc"; // Sorting direction

                    // Helper function to check if a value is a formatted number
                    function isNumber(value) {
                        var numberPattern = /^-?\d*(,\d{3})*(.\d+)?%?$/;
                        return numberPattern.test(value);
                    }

                    while (switching) {
                        switching = false;
                        rows = table.rows;

                        for (i = 1; i < (rows.length - 1); i++) {
                            shouldSwitch = false;
                            x = rows[i].getElementsByTagName("TD")[n];
                            y = rows[i + 1].getElementsByTagName("TD")[n];

                            if (dir == "asc") {
                                if (isNumber(x.innerHTML) && isNumber(y.innerHTML)) {
                                    var xValue = parseFloat(x.innerHTML.replace(/[^0-9.-]+/g, ''));
                                    var yValue = parseFloat(y.innerHTML.replace(/[^0-9.-]+/g, ''));
                                    
                                    if (xValue > yValue) {
                                        shouldSwitch = true;
                                        break;
                                    }
                                } else if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                                    shouldSwitch = true;
                                    break;
                                }
                            } else if (dir == "desc") {
                                if (isNumber(x.innerHTML) && isNumber(y.innerHTML)) {
                                    var xValue = parseFloat(x.innerHTML.replace(/[^0-9.-]+/g, ''));
                                    var yValue = parseFloat(y.innerHTML.replace(/[^0-9.-]+/g, ''));
                                    
                                    if (xValue < yValue) {
                                        shouldSwitch = true;
                                        break;
                                    }
                                } else if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                                    shouldSwitch = true;
                                    break;
                                }
                            }
                        }

                        if (shouldSwitch) {
                            rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                            switching = true;
                            switchcount++;
                        } else {
                            if (switchcount == 0 && dir == "asc") {
                                dir = "desc";
                                switching = true;
                            }
                        }
                    }
                }

            </script>
        </body>
    </html>